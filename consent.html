<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trust Clinic - Consent Confirmation</title>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />
</head>
<body class="bg-light d-flex align-items-center justify-content-center vh-100">
  <div class="card shadow p-4 text-center" style="width: 400px;">
    <img
      src="https://qpyqhdwxphskmjbespbu.supabase.co/storage/v1/object/public/logo/logo.png"
      class="mb-3"
      width="120"
      alt="Trust Clinic Logo"
    />
    <h4 class="mb-2">Consent Confirmation</h4>
    <p id="message">Loading patient info...</p>

    <div id="buttons" style="display:none;">
      <button class="btn btn-success me-2" onclick="sendConsent('approved')">
        Approve
      </button>
      <button class="btn btn-danger" onclick="sendConsent('declined')">
        Decline
      </button>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const patientId = urlParams.get("id");
    const messageEl = document.getElementById("message");
    const buttonsEl = document.getElementById("buttons");

    // Check if ID exists
    if (!patientId) {
      messageEl.innerText = "Invalid or missing patient ID in URL.";
    } else {
      messageEl.innerHTML = `
        <b>Patient ID:</b> ${patientId}<br>
        Please review and confirm your consent below.
      `;
      buttonsEl.style.display = "block";
    }

    async function sendConsent(status) {
      try {
        const response = await fetch("https://auto.trustx.tech/webhook-test/consent", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            patient_id: patientId,
            consent_answer: status
          })
        });

        if (response.ok) {
          document.querySelector(".card").innerHTML = `
            <h4>Thank you!</h4>
            <p>Your consent has been recorded as: 
              <b class="${status === "approved" ? "text-success" : "text-danger"}">
                ${status.toUpperCase()}
              </b>
            </p>
          `;
        } else {
          throw new Error("Failed to submit consent.");
        }
      } catch (error) {
        alert("Something went wrong. Please try again.");
        console.error(error);
      }
    }
  </script>
</body>
</html>

